[Unit]
Description=Podman container-cf-ddns.service
Documentation=man:podman-generate-systemd(1)
Wants=network-online.target
After=network-online.target
RequiresMountsFor=%t/containers

[Service]
Environment=PODMAN_SYSTEMD_UNIT=%n
Restart=always
TimeoutStopSec=70
ExecStartPre=/bin/rm \
        -f %t/%n.ctr-id
ExecStart=/usr/bin/podman container run \
        --cidfile=%t/%n.ctr-id \
        --cgroups=no-conmon \
        --rm \
        --sdnotify=conmon \
        --replace \
        --name {{ _cf_ddns_container_name }} \
        --pull=always \
        --env CF_DDNS_TOKEN={{ cf_ddns_token }} \
        --env CF_DDNS_ZONE_ID={{ cf_ddns_zone_id }} \
        --env CF_DDNS_HOST={{ cf_ddns_host }} \
        --env CF_DDNS_INTERVAL={{ cf_ddns_interval }} \
        --env CF_DDNS_TTL={{ cf_ddns_ttl }} \
        --env CF_DDNS_PROXIED={{ cf_ddns_proxied }} \
        --env CF_DDNS_LOGLEVEL={{ cf_ddns_loglevel }} \
        --env CF_DDNS_METRICS_PORT={{ cf_ddns_metrics_port }} \
        --publish {{ cf_ddns_metrics_host }}:{{ cf_ddns_metrics_port }}:{{ cf_ddns_metrics_port }} \
        --detach=True {{ cf_ddns_image_name }}:{{ cf_ddns_image_version }}
ExecStop=/usr/bin/podman stop \
        --ignore -t 10 \
        --cidfile=%t/%n.ctr-id
ExecStopPost=/usr/bin/podman rm \
        -f \
        --ignore -t 10 \
        --cidfile=%t/%n.ctr-id
Type=notify
NotifyAccess=all

[Install]
WantedBy=default.target
